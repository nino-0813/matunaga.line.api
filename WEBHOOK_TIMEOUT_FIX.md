# Webhookタイムアウトエラーの解決方法

## 🔴 エラー内容
「Webhookイベントオブジェクト送信時にタイムアウトが発生しました」

## 💡 原因
Renderの無料プランでは、15分間アクセスがないとサービスがスリープします。スリープ状態のサービスは、初回アクセス時に起動に時間がかかり、タイムアウトが発生することがあります。

## ✅ 解決方法

### ステップ1: サービスを起動させる

ブラウザで以下のURLにアクセスして、サービスを起動させてください：

```
https://matunaga-ai-api-1.onrender.com/
```

または

```
https://matunaga-ai-api-1.onrender.com/callback
```

**確認方法**:
- ページが表示される（または「LINE Bot is running」などのJSONレスポンスが返る）
- 数秒待ってから、再度アクセスして応答を確認

### ステップ2: 少し待つ（30秒〜1分）

サービスが完全に起動するまで、30秒〜1分程度待ってください。

### ステップ3: LINE Webhook検証を再試行

1. LINE Developers Consoleに戻る
2. 「検証」ボタンを再度クリック
3. 成功することを確認

---

## 🔄 それでもエラーが出る場合

### 方法1: Renderダッシュボードでサービス状態を確認

1. Renderダッシュボードを開く
2. サービスの状態を確認
   - 「Live」になっているか確認
   - ログにエラーがないか確認

### 方法2: サービスを再起動

1. Renderダッシュボードでサービスを開く
2. 「Manual Deploy」→「Deploy latest commit」をクリック
3. デプロイが完了するまで待つ
4. サービスURLにアクセスして起動を確認
5. LINE Webhook検証を再試行

### 方法3: 環境変数を確認

以下の環境変数がすべて設定されているか確認：

- ✅ `LINE_CHANNEL_ACCESS_TOKEN`
- ✅ `LINE_CHANNEL_SECRET`
- ✅ `OPENAI_API_KEY`

---

## 📝 今後の対策

### スリープを防ぐ方法（オプション）

1. **有料プランにアップグレード**（$7/月）
   - スリープしなくなる
   - 常時起動状態

2. **外部サービスで定期アクセス**（無料）
   - UptimeRobot（https://uptimerobot.com/）など
   - 定期的にURLにアクセスしてスリープを防ぐ

---

## ⚠️ 注意事項

- 無料プランでは、スリープから復帰するまで**30秒〜1分**かかることがあります
- 検証ボタンを押す前に、必ずサービスURLにアクセスして起動させてください
- サービスが起動したら、すぐに検証できるようになります

